import json
#import urllib
#from pathlib import Path
from stringProcess import StringProcess
from Report import Report

with open('Response.json', 'r') as f:
	data=json.load(f)
	hits=data['rawResponse']['hits']['hits']
	length=len(hits)

	parsed_data=[]
	#cnt=1
	header=['TestCase','OutputUrlDecoded', 'OrderOfOutputUrlParams', 'OrderOfOutputCustParams','OrderTestResult_UrlParam','OrderTestResult_CustParam','AddUrl_Test','EditUrl_Test','KeepUrl_test','DeleteUrl_Test','AddCust_Test','EditCust_Test','KeepCust_Test','DeleteCust_Test','Param Specific Test']
	#parsed_data.append(header)
	for item in hits:
		# if cnt%2==1:
		# 	cnt+=1
		# 	continue
		# cnt+=1
		if 'url' not in item['_source']:
			continue
		url = item['_source']['url']
		print(url)
		#decoded_url = str(urllib.parse.unquote(url))
		obj = StringProcess(url)
		obj.CheckOrder()
		obj.CheckForDeleteParams()
		obj.CheckForAddParams()
		obj.CheckForEditParams()
		obj.CheckForKeepParams()

		row=[]
		testcase_name = obj.GetTestCaseName()
		row.append(testcase_name)
		row.append(obj.GetDecodedOutputUrl())
		row.append(obj.GetUrlParamList(obj.url_param_list))#(obj.url_param_list)
		row.append(obj.GetCustParamList(obj.cust_param_list))#(obj.cust_param_list)
		row.append(obj.GetUrlParamOrderTestResult())
		row.append(obj.GetCustParamOrderTestResult())
		row.append(obj.GetAddUrlParamTestResult())
		row.append(obj.GetEditUrlParamTestResult())
		row.append(obj.GetKeepUrlParamTestResult())

		row.append(obj.GetDeleteUrlParamTestResult())
		row.append(obj.GetAddCustParamTestResult())
		row.append(obj.GetEditCustParamTestResult())
		row.append(obj.GetKeepCustParamTestResult())
		row.append(obj.GetDeleteCustParamTestResult())

		if 'AutoGenerated' in testcase_name:
			row.append("Not Applicable")
		else:
			obj.CheckForParamSpecificTest()
			row.append(obj.GetParamSpecificTestResult())

		parsed_data.insert(0,row)

	parsed_data.insert(0,header)
	report = Report(parsed_data)
	report.generateReport()
		